#NAME hsm_probe_beamicon2_subroutine.txt #LABEL "Subroutines to support Probing in HSM Works / Fusin 360 "

Unterprogramm fÃ¼r die Antastfunktion aus HSM Works / Fusion 360

#100 (Anfahrgeschwindigkeit)
#101 (Ausfahrgeschwindigkeit für Messung)
#103 (Slow probe distance)
#4 (Probe cycle Ã¼bermittelt vom PP)
#6 (Startpunkt Y)
#10 (Cycle Depth von Rueckzugshoehe)
#13 (Abstand Probe zu Werkstueck)
#14 (max. Abstand Taster - Kante)
#17 (Werkstueckhoehe in Y Richtung)
#15 (Rueckzugshoehe HSM Works)
#19 (Abstand zwischen 2 Tastpunkten)
#21 (Ermittelte Kante Y-Achse, Tastkugel nicht berÃ¼cksichtigt)
#22 (verwendeter Nullpunkt G54..G59)
#23 (Ermittelte Kante X-Achse, Tastkugel nicht berÃ¼cksichtigt)
#24 (Ermittelte Kante Z-Achse, Tastkugel nicht berÃ¼cksichtigt)
#26 (Winkel für verdrehung)
#27 (Aktueller X Wert)
#28 (Aktueller Y Wert)
#29 (Aktueller Z Wert)

#925 (Werkzeuglaenge)
#951 (tiefste Z-Position)
#955 (Durchmesser Tastkugel)
#982 (Offset Z für 3D-Taster)

#I9 (Eingang fÃ¼r Kantentaster)

%
#27=X
#28=Y
#29=Z

(######################################################## Einzelflaeche X ########################################################)
IF #4=1 THEN

IF #954=0 | #955=0 | #957=0 | #958=0 THEN (Parameter nicht gesetzt)
  PRINT "undefined macro parameters, please check variables #951 and up"
  M2
ENDIF
#22=#909 (verwendeter Nullpunkt G54..G59)
IF #22=0 THEN
  PRINT "no offset G54..G59 selected"
  M2
ENDIF

G21 G40 G90 G94

G0 Z=#15-#10 (Z auf ProbehÃ¶he aus HSM Works fahren)


G1 F=#100 UNTIL #I9=1 X=X+#13+#14
IF #I9=0 THEN 
  PRINT "left edge not found"
  M2 
ENDIF
G1 F=#101 UNTIL #I9=0 X=#27
IF #I9=1 THEN 
  PRINT "probe switch not released"
  M2 
ENDIF
#23=X (Ermittelte Kante X-Achse, Tastkugel nicht berÃ¼cksichtigt)
G0 X=#27
#900=#900+#23+#955/2
L53 (Nullpunkt speichern)
G0 Z=0
RETURN 


ENDIF
(###################################################### Einzelflaeche X End ######################################################)



(######################################################## Einzelflaeche Y ########################################################)
IF #4=2 THEN

IF #954=0 | #955=0 | #957=0 | #958=0 THEN (Parameter nicht gesetzt)
  PRINT "undefined macro parameters, please check variables #951 and up"
  M2
ENDIF
#22=#909 (verwendeter Nullpunkt G54..G59)
IF #22=0 THEN
  PRINT "no offset G54..G59 selected"
  M2
ENDIF

G21 G40 G90 G94

G0 Z=#15-#10 (Z auf ProbehÃ¶he aus HSM Works fahren)

G1 F=#100 UNTIL #I9=1 Y=Y+#13+#14
IF #I9=0 THEN 
  PRINT "front edge not found"
  M2 
ENDIF
G1 F=#101 UNTIL #I9=0 Y=#28
IF #I9=1 THEN 
  PRINT "probe switch not released"
  M2 
ENDIF
#21=Y (Ermittelte Kante Y-Achse, Tastkugel nicht berÃ¼cksichtigt)
G0 Y=#28
#901=#901+#21+#955/2
L53 (Nullpunkt speichern)
G0 Z=0
RETURN 


ENDIF
(###################################################### Einzelflaeche Y End ######################################################)



(######################################################## Einzelflaeche Z ########################################################)
IF #4=3 THEN

IF #951=0 THEN
  PRINT "undefined macro parameters, please check variables #951 and up"
  M2
ENDIF
G21 G40 G90 G94
#22=#909   (letzter Nullpunkt G54...)

IF #22=0 THEN
  PRINT "no offset G54..G59 selected"
  M2
ENDIF
G53
G1 F=#100 UNTIL #I9=1 Z=#951-#925
IF #I9=0 THEN 
  PRINT "probe switch not triggered"
  #909=#22
  M2 
ENDIF 
G1 F=#101 UNTIL #I9=0 Z=Z+2
IF #I9=1 THEN 
  PRINT "probe switch not released" 
  #909=#22
  M2 
ENDIF 

#24=Z (Ermittelte Kante Z-Achse, Tastkugel nicht berÃ¼cksichtigt)
G0 Z0 (Taster freifahren)
#909=#22 (alten Nullpunkt vor G53 reaktivieren)
#902=#24-#925 (#925 gemessen Werkzeuglänge von 3D Taster)
PRINT "Offset G";53+#1;" Z=";#902
L53 (Nullpunkt speichern)
RETURN 
ENDIF 
(###################################################### Einzelflache Z End ######################################################)

(######################################################## HSM Auswahl ########################################################)
IF #4=2 THEN
ENDIF 
(###################################################### HSM Auswahl End ######################################################)

(######################################################## HSM Auswahl ########################################################)
IF #4=5 THEN

IF #954=0 | #955=0 | #957=0 | #958=0 THEN (Parameter nicht gesetzt)
  PRINT "undefined macro parameters, please check variables #951 and up"
  M2
ENDIF
#22=#909 (verwendeter Nullpunkt G54..G59)
IF #22=0 THEN
  PRINT "no offset G54..G59 selected"
  M2
ENDIF
G21 G40 G90 G94

G0 Z=#15 (Taster auf Rueckzugshoehe fahren)
G0 Y=#28+(#17/2)+#13+(#955/2) (Y Ache positiv Verfahren um die HÃ¤lfte der Werkstuecklange + Abstand aus HSM Works + 1/2D Tastspitze)
G0 Z=#15-#10 (Z auf ProbehÃ¶he aus HSM Works fahren)

G1 F=#100 UNTIL #I9=1 Y=Y-#13-#14
IF #I9=0 THEN 
  PRINT "front edge not found"
  M2 
ENDIF
G1 F=#101 UNTIL #I9=0 Y=Y+2
IF #I9=1 THEN 
  PRINT "probe switch not released"
  M2 
ENDIF
#21=Y (Ermittelte Kante Y-Achse, Tastkugel nicht berÃ¼cksichtigt)
G0 Y=Y+2
G0 Z=#15
G0 Y=#28-(#17/2)-#13-(#955/2) (Y Ache negativ Verfahren um die HÃ¤lfte der Werkstuecklange + Abstand aus HSM Works + 1/2D Tastspitze)
G0 Z=#15-#10 (Z auf ProbehÃ¶he aus HSM Works fahren)

G1 F=#100 UNTIL #I9=1 Y=Y+#13+#14
IF #I9=0 THEN 
  PRINT "front edge not found"
  M2 
ENDIF
G1 F=#101 UNTIL #I9=0 Y=Y-2
IF #I9=1 THEN 
  PRINT "probe switch not released"
  M2 
ENDIF

G0 Y=Y-2
G0 Z=#15
G0 Y=(Y+#21)/2
#28=Y



PRINT "Y=";#28
#901=#901+#28+#955/2
L53 (Nullpunkt speichern)
RETURN 


ENDIF
(###################################################### HSM Auswahl End ######################################################)


(######################################################## Einzelner Flaechenwinkel Y ########################################################)
IF #4=19 THEN

IF #954=0 | #955=0 | #957=0 | #958=0 THEN (Parameter nicht gesetzt)
  PRINT "undefined macro parameters, please check variables #951 and up"
  M2
ENDIF
#22=#909 (verwendeter Nullpunkt G54..G59)
IF #22=0 THEN
  PRINT "no offset G54..G59 selected"
  M2
ENDIF

G21 G40 G90 G94

G0 Z=#15-#10 (Z auf ProbehÃ¶he aus HSM Works fahren)
G0 X=#27-(#19/2)

G1 F=#100 UNTIL #I9=1 Y=Y+#13+#14
IF #I9=0 THEN 
  PRINT "front edge not found"
  M2 
ENDIF
G1 F=#101 UNTIL #I9=0 Y=#28
IF #I9=1 THEN 
  PRINT "probe switch not released"
  M2 
ENDIF
#21=Y (Ermittelte Kante Y-Achse, Tastkugel nicht berÃ¼cksichtigt)
G0 Y=#28

G0 X=#27+(#19/2)
G1 F=#100 UNTIL #I9=1 Y=Y+#13+#14
IF #I9=0 THEN 
  PRINT "front edge not found"
  M2 
ENDIF
G1 F=#101 UNTIL #I9=0 Y=#28
IF #I9=1 THEN 
  PRINT "probe switch not released"
  M2 
ENDIF
#26=ATAN((Y-#21)/#19)*(180/(4*ATAN(1)))
G0 Y=#28
PRINT "Winkel R=";#26
G68 X0 Y0 R=#26
G0 Z=0

RETURN
ENDIF
(###################################################### Einzelner Flaechenwinkel Y END ######################################################)

Simulation: 
PRINT "Edge-finder with 3D-probe (simulation)"
RETURN